{% extends "sitio_publico/base.html" %}

{% block title %}
Nómina · Registro Audiovisual
{% endblock %}

{% block content %}

<!-- HERO -->
<section class="fomento-hero text-center">
  <h1 class="fw-bold mb-2">Nómina del Registro Audiovisual</h1>
  <p class="text-white mb-0">
    Vista interna de administración
  </p>
</section>

<div class="container py-4">

  <!-- BUSCADOR + EXCEL -->
  <div class="dav-card mb-3">
    <form method="get" class="row g-2 align-items-center">

      <div class="col-12 col-lg-6">
        <input
          type="text"
          name="q"
          value="{{ q }}"
          class="form-control"
          placeholder="Buscar por nombre / razón social o email"
        >
      </div>

      <div class="col-12 col-lg-auto">
        <button type="submit" class="btn btn-dark w-100">
          Buscar
        </button>
      </div>

      <div class="col-12 col-lg-auto">
        <a href="{% url 'backoffice:nomina_registro' %}"
           class="btn btn-outline-secondary w-100">
          Limpiar
        </a>
      </div>

      <div class="col-12 col-lg-auto ms-lg-auto">
        <a href="{% url 'backoffice:nomina_registro_excel' %}{% if q %}?q={{ q|urlencode }}{% endif %}"
           class="btn btn-success w-100">
          Descargar Excel
        </a>
      </div>

    </form>
  </div>

  <!-- TABLA -->
  <div class="dav-card">
    <div class="table-responsive">

      <table class="table align-middle mb-0">
        <thead>
          <tr>
            <th style="width:90px;">ID</th>
            <th>Nombre / Razón social</th>
            <th style="width:170px;">Tipo de persona</th>
            <th>Correo electrónico</th>
            <th style="width:190px;">Fecha registro / renovación</th>
          </tr>
        </thead>

        <tbody>
          {% for r in rows %}
            <tr>

              <td class="text-muted">
                #{{ r.id }}
              </td>

              <td class="fw-semibold">
                <a href="{{ r.url_admin }}"
                   class="text-decoration-none"
                   target="_blank">
                  {{ r.display }}
                </a>
              </td>

              <td>
                {{ r.tipo }}
              </td>

              <td>
                {% if r.email %}
                  <a href="mailto:{{ r.email }}"
                     class="text-decoration-none">
                    {{ r.email }}
                  </a>
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>

              <td>
                {% if r.fecha %}
                  {{ r.fecha|date:"d/m/Y H:i" }}
                {% else %}
                  <span class="text-muted">—</span>
                {% endif %}
              </td>

            </tr>
          {% empty %}
            <tr>
              <td colspan="5" class="text-center text-muted py-4">
                No hay registros para mostrar.
              </td>
            </tr>
          {% endfor %}
        </tbody>

      </table>

    </div>
  </div>

</div>

{% endblock %}
