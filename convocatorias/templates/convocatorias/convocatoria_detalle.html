{% extends "sitio_publico/base.html" %}
{% load static %}

{% block title %}
  {{ convocatoria.titulo }} · Convocatoria
{% endblock %}

{% block content %}
<div class="container py-5">

  <div class="row ficha-convocatoria">

    <!-- ================================================= -->
    <!-- COLUMNA IZQUIERDA -->
    <!-- ================================================= -->
    <div class="col-12 col-lg-8 convocatoria-left">

      <!-- HERO TÍTULO CON IMAGEN (ESTILO MUBI) -->
      <div class="convocatoria-hero mb-4"
           {% if convocatoria.imagen %}
           style="background-image: url('{{ convocatoria.imagen.url }}');"
           {% endif %}>
        <div class="convocatoria-hero-overlay">
          <h1 class="convocatoria-hero-title">
            {{ convocatoria.titulo }}
          </h1>
        </div>
      </div>

      {% if convocatoria.descripcion_larga or convocatoria.descripcion_corta %}
      <div class="descripcion-convocatoria mb-4">
        {% if convocatoria.descripcion_larga %}
          {{ convocatoria.descripcion_larga|linebreaks }}
        {% else %}
          {{ convocatoria.descripcion_corta|linebreaks }}
        {% endif %}
      </div>
      {% endif %}

      <!-- BOTÓN VOLVER -->
      <div class="mt-4 mb-5">
        <a href="{% url 'convocatorias:convocatorias_home' %}"
           class="btn btn-outline-info btn-sm">
          Volver
        </a>
      </div>

      <!-- ================================================= -->
      <!-- JURADOS / FORMADORES / TUTORES (SIN CAMBIOS) -->
      <!-- ================================================= -->
      {% if convocatoria.jurado1_nombre or convocatoria.jurado2_nombre or convocatoria.jurado3_nombre %}
      <div class="mb-5">

        {% if convocatoria.bloque_personas != "NINGUNO" %}
        <h3 class="fw-bold mb-4">
          {% if convocatoria.bloque_personas == "JURADO" %}
            Jurado
          {% elif convocatoria.bloque_personas == "FORMADORES" %}
            Formadores
          {% elif convocatoria.bloque_personas == "TUTORES" %}
            Tutores
          {% endif %}
          <hr class="my-2 border-dotted"><br>
        </h3>
        {% endif %}

        <div class="vstack gap-4">

          {% if convocatoria.jurado1_nombre %}
          <div class="card border-0 shadow-sm p-3 jurado-card">
            <div class="row g-3">
              <div class="col-md-3 text-center d-none d-md-block">
                {% if convocatoria.jurado1_foto %}
                  <img src="{{ convocatoria.jurado1_foto.url }}" class="jurado-foto">
                {% endif %}
                <h6 class="fw-bold mt-2">{{ convocatoria.jurado1_nombre }}</h6>
              </div>
              <div class="col-12 col-md-9">
                <h6 class="fw-bold d-md-none">{{ convocatoria.jurado1_nombre }}</h6>
                <p class="jurado-bio">
                  {{ convocatoria.jurado1_bio|linebreaks }}
                </p>
              </div>
            </div>
          </div>
          {% endif %}

          {% if convocatoria.jurado2_nombre %}
          <div class="card border-0 shadow-sm p-3 jurado-card">
            <div class="row g-3">
              <div class="col-md-3 text-center d-none d-md-block">
                {% if convocatoria.jurado2_foto %}
                  <img src="{{ convocatoria.jurado2_foto.url }}" class="jurado-foto">
                {% endif %}
                <h6 class="fw-bold mt-2">{{ convocatoria.jurado2_nombre }}</h6>
              </div>
              <div class="col-12 col-md-9">
                <h6 class="fw-bold d-md-none">{{ convocatoria.jurado2_nombre }}</h6>
                <p class="jurado-bio">
                  {{ convocatoria.jurado2_bio|linebreaks }}
                </p>
              </div>
            </div>
          </div>
          {% endif %}

          {% if convocatoria.jurado3_nombre %}
          <div class="card border-0 shadow-sm p-3 jurado-card">
            <div class="row g-3">
              <div class="col-md-3 text-center d-none d-md-block">
                {% if convocatoria.jurado3_foto %}
                  <img src="{{ convocatoria.jurado3_foto.url }}" class="jurado-foto">
                {% endif %}
                <h6 class="fw-bold mt-2">{{ convocatoria.jurado3_nombre }}</h6>
              </div>
              <div class="col-12 col-md-9">
                <h6 class="fw-bold d-md-none">{{ convocatoria.jurado3_nombre }}</h6>
                <p class="jurado-bio">
                  {{ convocatoria.jurado3_bio|linebreaks }}
                </p>
              </div>
            </div>
          </div>
          {% endif %}

        </div>
      </div>
      {% endif %}

    </div>

    <!-- ================================================= -->
    <!-- COLUMNA DERECHA (SIN CAMBIOS) -->
    <!-- ================================================= -->
    <div class="col-12 col-lg-4 convocatoria-right">

      <div class="card1 mb-3 border-0 shadow-sm">
        <div class="card-body">

          <h6 class="fw-bold text-uppercase small mb-3">
            Información rápida
          </h6>

          <ul class="list-unstyled small mb-3">

            <li>
              <strong>Categoría:</strong>
              {{ convocatoria.get_categoria_display }}
              <hr class="my-2 border-dotted">
            </li>

            {% if convocatoria.tematica_genero %}
            <li>
              <strong>Detalle:</strong>
              <div class="text-muted">
                {{ convocatoria.tematica_genero|linebreaksbr }}
              </div>
              <hr class="my-2 border-dotted">
            </li>
            {% endif %}

            <li>
              <strong>Convocatoria:</strong>
              {% if convocatoria.vigente %}
                <span class="badge bg-success ms-1">Abierta</span>
                <span class="text-muted small">
                  hasta {{ convocatoria.fecha_fin|date:"d/m/Y" }}
                </span>
              {% else %}
                <span class="badge bg-danger ms-1">Cerrada</span>
              {% endif %}
              <hr class="my-2 border-dotted">
            </li>

            {% if convocatoria.requisitos %}
            <li>
              <strong>Requisitos:</strong>
              <div class="text-muted">
                {{ convocatoria.requisitos|linebreaksbr }}
              </div>
              <hr class="my-2 border-dotted">
            </li>
            {% endif %}

            {% if convocatoria.beneficios %}
            <li>
              <strong>Beneficios:</strong>
              <div class="text-muted">
                {{ convocatoria.beneficios|linebreaksbr }}
              </div>
              <hr class="my-2 border-dotted">
            </li>
            {% endif %}

          </ul>

          <div class="d-grid gap-2">
            {% if convocatoria.vigente %}
              {% if convocatoria.url_curso %}
                <a href="{{ convocatoria.url_curso }}"
                   target="_blank"
                   class="btn btn-warning btn-sm">
                  Acceder al curso
                </a>
              {% else %}
                <a href="{% url 'convocatorias:inscribirse_convocatoria' convocatoria.slug %}"
                   class="btn btn-primary btn-sm">
                  Inscribirme
                </a>
              {% endif %}
            {% endif %}

            {% if convocatoria.bases_pdf %}
              <a href="{{ convocatoria.bases_pdf.url }}"
                 target="_blank"
                 class="btn btn-outline-primary btn-sm">
                Bases y condiciones
              </a>
            {% endif %}
          </div>

        </div>
      </div>

    </div>

  </div>
</div>
{% endblock %}
