{% extends "sitio_publico/base.html" %}
{% load static %}

{% block title %}
  {{ convocatoria.titulo }} · Inscripción
{% endblock %}

{% block content %}

<!-- HERO UNIFICADO -->
<section class="fomento-hero text-center">
  <h1 class="fw-bold mb-2">Inscripción</h1>
  <p class="text-white mb-0">
    {{ convocatoria.titulo }}
  </p>
</section>

<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">

      <div class="dav-card mb-4">
        <h3 class="mb-2">Formulario de inscripción</h3>

        {% if persona_humana or persona_juridica %}
          <p class="text-muted mb-3">
            Detectamos que ya completaste el Registro Audiovisual.
            Para esta inscripción vamos a usar automáticamente esos datos.
          </p>
        {% else %}
          <p class="text-muted mb-3">
            No es obligatorio estar inscripto/a en el Registro Audiovisual para capacitarte.
            Completá estos datos mínimos para poder contactarte.
          </p>
        {% endif %}

        <form method="post" class="row g-3">
          {% csrf_token %}

          {% if form.non_field_errors %}
            <div class="col-12">
              <div class="alert alert-danger">
                {{ form.non_field_errors }}
              </div>
            </div>
          {% endif %}

          {# ===================================================== #}
          {# DATOS DE CONTACTO: SOLO SI NO HAY REGISTRO            #}
          {# (si hay registro, estos campos están hidden y no se muestran) #}
          {# ===================================================== #}
          {% if not persona_humana and not persona_juridica %}

            <div class="col-md-6">
              <label class="form-label" for="id_nombre">Nombre</label>
              {{ form.nombre }}
              {% if form.nombre.errors %}<div class="text-danger small">{{ form.nombre.errors }}</div>{% endif %}
            </div>

            <div class="col-md-6">
              <label class="form-label" for="id_apellido">Apellido</label>
              {{ form.apellido }}
              {% if form.apellido.errors %}<div class="text-danger small">{{ form.apellido.errors }}</div>{% endif %}
            </div>

            <div class="col-md-6">
              <label class="form-label" for="id_dni">DNI</label>
              {{ form.dni }}
              {% if form.dni.errors %}<div class="text-danger small">{{ form.dni.errors }}</div>{% endif %}
            </div>

            <div class="col-md-6">
              <label class="form-label" for="id_email">Email</label>
              {{ form.email }}
              {% if form.email.errors %}<div class="text-danger small">{{ form.email.errors }}</div>{% endif %}
            </div>

            <div class="col-md-6">
              <label class="form-label" for="id_telefono">Teléfono</label>
              {{ form.telefono }}
              {% if form.telefono.errors %}<div class="text-danger small">{{ form.telefono.errors }}</div>{% endif %}
            </div>

            <div class="col-md-6">
              <label class="form-label" for="id_localidad">Localidad</label>
              {{ form.localidad }}
              {% if form.localidad.errors %}<div class="text-danger small">{{ form.localidad.errors }}</div>{% endif %}
            </div>

            <div class="col-12" id="wrap-otra-localidad">
              <label class="form-label" for="id_otra_localidad">¿Cuál?</label>
              {{ form.otra_localidad }}
              {% if form.otra_localidad.errors %}<div class="text-danger small">{{ form.otra_localidad.errors }}</div>{% endif %}
              <small class="text-muted d-block">
                Completá este campo solo si en “Localidad” elegiste “Otro”.
              </small>
            </div>

          {% else %}
            {# Si hay registro, igual renderizamos los hidden para que viajen en POST si hiciera falta #}
            {{ form.nombre }}
            {{ form.apellido }}
            {{ form.dni }}
            {{ form.email }}
            {{ form.telefono }}
            {{ form.localidad }}
            {{ form.otra_localidad }}
          {% endif %}

          {# ===================================================== #}
          {# CAMPOS QUE SIEMPRE SE COMPLETAN (con o sin registro)  #}
          {# ===================================================== #}
          <div class="col-12">
            <label class="form-label" for="id_vinculo_sector">Vínculo con el sector audiovisual</label>
            {{ form.vinculo_sector }}
            {% if form.vinculo_sector.errors %}<div class="text-danger small">{{ form.vinculo_sector.errors }}</div>{% endif %}
          </div>

          <div class="col-12">
            <div class="form-check">
              {{ form.declaracion_jurada }}
              <label class="form-check-label" for="id_declaracion_jurada">
                Declaro que los datos ingresados son correctos.
              </label>
            </div>
            {% if form.declaracion_jurada.errors %}<div class="text-danger small">{{ form.declaracion_jurada.errors }}</div>{% endif %}
          </div>

          <div class="col-12 text-end mt-2">
            <button type="submit" class="btn btn-primary">
              Enviar inscripción
            </button>
            <a href="{% url 'convocatorias:convocatoria_detalle' convocatoria.slug %}"
               class="btn btn-outline-secondary ms-2">
              Volver
            </a>
          </div>

        </form>
      </div>

      <div class="dav-card">
        <h4 class="fw-bold mb-2">Información</h4>
        {% if convocatoria.descripcion_corta %}
          <p class="text-muted mb-0">{{ convocatoria.descripcion_corta }}</p>
        {% else %}
          <p class="text-muted mb-0">
            Una vez enviada la inscripción, vas a poder ver el estado desde tu panel.
          </p>
        {% endif %}
      </div>

    </div>
  </div>
</div>

{% if not persona_humana and not persona_juridica %}
<!-- ✅ Mostrar/ocultar "otra_localidad" según la selección -->
<script>
  (function () {
    const sel = document.getElementById("id_localidad");
    const wrap = document.getElementById("wrap-otra-localidad");

    function toggle() {
      if (!sel || !wrap) return;
      wrap.style.display = (sel.value === "otro") ? "block" : "none";
    }

    document.addEventListener("change", function (e) {
      if (e.target && e.target.id === "id_localidad") toggle();
    });

    toggle();
  })();
</script>
{% endif %}

{% endblock %}
