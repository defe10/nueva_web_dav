{% extends "sitio_publico/base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'sitio_publico/css/registro.css' %}">
{% endblock %}

{% block content %}

<!-- HERO -->
<div class="registro-base-hero text-white text-center d-flex flex-column justify-content-center align-items-center">
  <h1 class="mb-3">Registro Audiovisual</h1>
  <h2>Persona Jurídica</h2>
</div>

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-8 text-center">

      <div class="d-flex justify-content-between mb-4 small text-muted">
        <div>1. Tipo de persona</div>
        <div class="fw-bold text-info">2. Completar datos y enviar</div>
      </div>

    </div>
  </div>
</div>

<div class="container py-3">
  <div class="row justify-content-center">

    <!-- INFO -->
    <div class="col-lg-4 mb-4">
      <div class="memberRegistro">
        <h5 class="mb-3">Datos de la persona jurídica</h5>
        <p class="small">
          Ingresá los datos tal como figuran en la documentación oficial de la entidad.
          La información correcta y actualizada es esencial para validar la inscripción
          y agilizar cualquier trámite administrativo.
        </p>
        <p class="small">
          Al finalizar, hacé clic en <strong>“Enviar”</strong> para completar el registro.
          Podrás actualizar tus datos cuando quieras desde <em>Mi cuenta</em>.
        </p>
      </div>
    </div>

    <!-- FORMULARIO -->
    <div class="col-lg-8">
      <div class="memberRegistro">

        <h3 class="mb-2">Formulario de inscripción</h3>
        <p class="text-muted mb-4">
          Datos requeridos para la inscripción de Personas Jurídicas.
        </p>

        <form method="post" class="row g-3">
          {% csrf_token %}

          <!-- DATOS JURÍDICOS -->
          <div class="col-12">
            <h5>Datos de la persona jurídica</h5>
          </div>

          <div class="col-md-8">
            <label class="form-label">Tipo de persona jurídica</label>
            {{ form.tipo_persona_juridica }}
            {{ form.tipo_persona_juridica.errors }}
          </div>

          <div class="col-md-4">
            <label class="form-label">CUIT</label>
            {{ form.cuil_cuit }}
            <small class="text-muted">
            Sin espacios ni guiones.
            </small>
            {{ form.cuil_cuit.errors }}
          </div>

          <div class="col-md-6">
            <label class="form-label">Razón social</label>
            {{ form.razon_social }}<small class="text-muted">
            </small>
            {{ form.razon_social.errors }}
          </div>

          <div class="col-md-6">
            <label class="form-label">Nombre comercial</label>
            {{ form.nombre_comercial }}
            {{ form.nombre_comercial.errors }}
          </div>

          <div class="col-md-4">
            <label class="form-label">Domicilio fiscal</label>
            {{ form.domicilio_fiscal }}
            {{ form.domicilio_fiscal.errors }}
          </div>

          <div class="col-md-4">
            <label class="form-label">Código postal</label>
            {{ form.codigo_postal_fiscal }}
            {{ form.codigo_postal_fiscal.errors }}
          </div>

          <div class="col-md-4">
            <label class="form-label">Ciudad</label>
            {{ form.localidad_fiscal }}
            {{ form.localidad_fiscal.errors }}
          </div>

          <div class="col-md-8" id="otro-lugar-wrapper" style="display:none;">
            <label class="form-label">Especificar otro lugar</label>
            {{ form.otro_lugar_residencia }}
            {{ form.otro_lugar_residencia.errors }}
          </div>

          <div class="col-md-5">
            <label class="form-label">Fecha de constitución</label>
            {{ form.fecha_constitucion }}
            {{ form.fecha_constitucion.errors }}
          </div>

          <div class="col-md-2">
            <label class="form-label">Antigüedad</label>
            {{ form.antiguedad }}
            {{ form.antiguedad.errors }}
          </div>

          <div class="col-md-5">
            <label class="form-label">Teléfono</label>
            {{ form.telefono }}
            {{ form.telefono.errors }}
          </div>

          <div class="col-md-8">
            <label class="form-label">Correo electrónico</label>
            {{ form.email }}
            {{ form.email.errors }}
          </div>

          <!-- DATOS FISCALES -->
          <div class="col-12 mt-4">
            <h5>Datos fiscales</h5>
          </div>

          <div class="col-md-6">
            <label class="form-label">Situación ante el IVA</label>
            {{ form.situacion_iva }}
            {{ form.situacion_iva.errors }}
          </div>

          <div class="col-md-6">
            <label class="form-label">Actividad declarada en DGR</label>
            {{ form.actividad_dgr }}
            {{ form.actividad_dgr.errors }}
          </div>

          <!-- DATOS PROFESIONALES -->
          <div class="col-12 mt-4">
            <h5>Datos profesionales</h5>
          </div>

          <div class="col-md-6">
            <label class="form-label">Área de desempeño principal</label>
            {{ form.area_desempeno_JJPP_1 }}
            {{ form.area_desempeno_JJPP_1.errors }}
          </div>

          <div class="col-md-6">
            <label class="form-label">Área de desempeño secundaria</label>
            {{ form.area_desempeno_JJPP_2 }}
            {{ form.area_desempeno_JJPP_2.errors }}
          </div>

          <div class="col-12">
            <label class="form-label">Link de trabajos</label>
            {{ form.link_1 }}
            {{ form.link_1.errors }}
          </div>

          <div class="col-12">
            <label class="form-label">Link de trabajos</label>
            {{ form.link_2 }}
            {{ form.link_2.errors }}
          </div>

          {% if form.link_3 %}
          <div class="col-12">
            <label class="form-label">Link de trabajos</label>
            {{ form.link_3 }}
            {{ form.link_3.errors }}
          </div>
          {% endif %}

          <!-- BOTÓN -->
          <div class="col-12 text-end mt-4">
            <button type="submit" class="btn btn-primary">
              Enviar
            </button>
          </div>

        </form>

      </div>
    </div>

  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const select = document.querySelector("select[name$='lugar_residencia']");
  const otroWrapper = document.getElementById("otro-lugar-wrapper");

  if (!select || !otroWrapper) return;

  function toggleOtro() {
    if (!select.value) {
      otroWrapper.style.display = "none";
      return;
    }

    const selectedText =
      select.options[select.selectedIndex].text.toLowerCase();

    if (selectedText.includes("otro")) {
      otroWrapper.style.display = "block";
    } else {
      otroWrapper.style.display = "none";
    }
  }

  select.addEventListener("change", toggleOtro);
  toggleOtro();
});
</script>

<!-- JS: ANTIGÜEDAD -->
<script>
document.addEventListener("DOMContentLoaded", function() {
  const fechaInput = document.querySelector("#id_fecha_constitucion");
  const antiguedadInput = document.querySelector("#id_antiguedad");

  function calcularAntiguedad() {
    const fecha = new Date(fechaInput.value);
    if (!isNaN(fecha)) {
      const hoy = new Date();
      let antiguedad = hoy.getFullYear() - fecha.getFullYear();
      const m = hoy.getMonth() - fecha.getMonth();
      if (m < 0 || (m === 0 && hoy.getDate() < fecha.getDate())) {
        antiguedad--;
      }
      antiguedadInput.value = antiguedad;
    } else {
      antiguedadInput.value = "";
    }
  }

  fechaInput.addEventListener("change", calcularAntiguedad);
});
</script>

{% endblock %}
