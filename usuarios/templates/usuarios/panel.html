{% extends "sitio_publico/base.html" %}
{% load static %}

{% block content %}

<div class="container py-5">

    <h1 class="fw-bold mb-4 text-center">Mi Panel</h1>

    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">

            <!-- PANEL -->
            <div class="p-4 shadow"
                 style="border-radius: 16px; background: #fff;">

                <h4 class="fw-bold mb-3">
                    Bienvenido, {{ user.username }}
                </h4>

                <p class="text-muted">
                    Desde aquí podés consultar el estado de tu registro audiovisual
                    y acceder a las convocatorias disponibles.
                </p>

                <hr>

                <!-- ESTADO DEL REGISTRO -->
                {% if persona_humana or persona_juridica %}
                    <p class="mb-2">
                        <strong>Estado del registro audiovisual:</strong>
                        <span class="badge bg-success ms-2">Completado</span>
                    </p>

                    {% if persona_humana %}
                        <p class="text-muted small mb-1">
                            Registrado como <strong>Persona Humana</strong>.
                        </p>
                    {% endif %}

                    {% if persona_juridica %}
                        <p class="text-muted small mb-1">
                            Registrado como <strong>Persona Jurídica</strong>.
                        </p>
                    {% endif %}
                {% else %}
                    
                    <p class="mb-2">
                        <strong>Estado del registro audiovisual:</strong>
                        <span class="badge bg-warning text-dark ms-2">
                            Pendiente
                        </span>
                    </p>
                {% endif %}

                <hr>
                    <p class="mb-3"><strong>Mis convocatorias:</strong></p>
                    

{% if postulaciones %}
    {% for p in postulaciones %}
        <p class="mb-2">
            <strong>{{ p.convocatoria.titulo }}</strong><br>
            <span class="text-muted small">
                Proyecto: <strong>{{ p.nombre_proyecto }}</strong>
            </span>

            <span class="badge ms-2
                {% if p.estado == 'enviado' %}
                    bg-secondary
                {% elif p.estado == 'revision_admin' %}
                    bg-info
                {% elif p.estado == 'observado' %}
                    bg-warning text-dark
                {% elif p.estado == 'admitido' %}
                    bg-primary
                {% elif p.estado == 'evaluacion_jurado' %}
                    bg-primary
                {% elif p.estado == 'seleccionado' %}
                    bg-success
                {% elif p.estado == 'no_seleccionado' %}
                    bg-danger
                {% elif p.estado == 'finalizado' %}
                    bg-success
                {% else %}
                    bg-secondary
                {% endif %}
            ">
                {{ p.get_estado_display }}
            </span>
        </p>
    {% endfor %}
{% else %}
    <p class="text-muted small">
        No participaste en ninguna convocatoria.
    </p>
    <hr>
{% endif %}


                <!-- ACCIONES -->
                <div class="d-grid gap-3 mt-4">

                    {% if persona_humana %}
                        <a href="{% url 'registro_audiovisual:editar_persona_humana' %}"
                           class="btn btn-primary">
                            Editar mis datos (Persona Humana)
                        </a>
                    {% endif %}

                    {% if persona_juridica %}
                        <a href="{% url 'registro_audiovisual:editar_persona_juridica' %}"
                           class="btn btn-primary">
                            Editar mis datos (Persona Jurídica)
                        </a>
                    {% endif %}

                    {% if not persona_humana and not persona_juridica %}
                        <a href="{% url 'registro_audiovisual:seleccionar_tipo_registro' %}"
                           class="btn btn-warning">
                            Completar Registro Audiovisual
                        </a>
                    {% endif %}

                    <a href="{% url 'convocatorias:convocatorias_home' %}"
                       class="btn btn-outline-primary">
                        Ver Convocatorias Disponibles
                    </a>

                    {% if exencion %}
                        {% if exencion.certificado_pdf %}
                            <a href="{{ exencion.certificado_pdf.url }}"
                               class="btn btn-success"
                               download>
                                Descargar constancia de exención impositiva
                            </a>
                        {% else %}
                            <button class="btn btn-outline-secondary" disabled>
                                Exención impositiva en revisión
                            </button>
                        {% endif %}
                    {% endif %}

                    <a href="{% url 'usuarios:logout' %}"
                       class="btn btn-outline-danger">
                        Cerrar sesión
                    </a>

                </div>
                



            </div>
            <!-- /PANEL -->

        </div>
    </div>
</div>

{% endblock %}
